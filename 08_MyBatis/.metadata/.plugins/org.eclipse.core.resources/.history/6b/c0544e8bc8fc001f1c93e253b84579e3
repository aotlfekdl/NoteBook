<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>

    <jsp:include page="../common/menubar.jsp" />

    <div class="outer" align="center">
        <br>
        <h1 align="center">게시판 상세조회</h1>
        <br>

        <table align="center" border="1">
            <tr>
                <td width="100">글번호</td>
                <td width="500">${b.boardNo}</td>
            </tr>
            <tr>
                <td>제목</td>
                <td>${b.boardTitle}</td>
            </tr>
            <tr>
                <td>작성자</td>
                <td>${b.userId}</td>
            </tr>
            <tr>
                <td>조회수</td>
                <td>${b.count}</td>
            </tr>
            <tr>
                <td>작성일</td>
                <td>${b.createDate}</td>
            </tr>
            <tr>
                <td>내용</td>
                <td height="100">
                    ${b.boardContent}
                </td>
            </tr>
        </table>

        <br>
	<div id="reply-area">
        <table align="center" border="1" class="list-area">
            <c:choose>
			<c:when test="${loginUser == null}">
            <tr>
                <th>댓글작성</th>
                <th><textarea></textarea></th>
                <th><button onclick="insertReply(${board.boardNo})">등록</button></th>
            
            </tr>
            </c:when>
            </c:choose>
            <tbody>

            </tbody>
        </table>
        
        <script>
  	function init(bno){
        		const contentArea = document.querySelector("#list-area");
        		
        		$.ajax({
        			url:"rinsert.bo",
        			type: "post"
        			data:{
        				boardNo: bno,
        				content: contentArea.value
        			},
        			success: function(res){
        				contentArea.value = "",
        				getReplyList(bno, function(data){
        					drawReplyList(data);
        				});
        			},
        			error: function(error){
        				console.log("댓글 작성 ajax통신 실패");
        			}
        			})
        			}
        	function getReplyList(boardNo, callback){
        		$.ajax({
        			url: "rlist.bo",
        			dataType: "json",
        			data : {
        				bno: boardNo
        			},
        			success: function(replyList){
        				callback(replyList);
        			},
        			error: function(){
        				console.log("댓글 조회 ajax통신 실패");
        			}
        		})
        	}
        	function drawReplyList(replyList){
        		let str= "";
        		for(let r of replyList) {
        			str += "<tr>" +
        					"<td>" + r.userId + "</td>" +
        					"<td>" + r.replyContent + "</td>" + 
        					"<td>" + r.createDate + "</td>" +
        					"</tr>";
        		}
        		
        		const replyBody = document.querySelector("#reply-area tbody");
        		replyBody.innerHTML = str;
        	}      
  
        </script>
        </div>
    </div>
</body>
</html>